<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Church Events Calendar</title>
<style>
  :root {
    --primary: #2b6cb0;
    --bg: #f7f8fb;
    --card-bg: #ffffff;
    --text: #2d3748;
    --muted: #718096;
  }

  body {
    font-family: "Inter", system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 0;
  }

  header {
    text-align: center;
    padding: 1.2rem;
    background: var(--primary);
    color: white;
    font-size: 1.5rem;
    font-weight: 600;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  #calendar-container {
    max-width: 1100px;
    margin: 1.5rem auto;
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    overflow: hidden;
    padding: 1rem;
  }

  #calendar-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0 0.5rem;
  }

  #calendar-nav button {
    background: var(--primary);
    color: white;
    border: none;
    padding: 8px 14px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
  }

  #calendar-nav button:hover {
    background: #1e4f8a;
  }

  #month-year {
    font-size: 1.2rem;
    font-weight: 600;
  }

  #calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
  }

  .day-name {
    text-align: center;
    font-weight: 600;
    color: var(--muted);
    padding: 6px 0;
    font-size: 0.9rem;
  }

  .day {
    background: var(--card-bg);
    border-radius: 10px;
    padding: 6px;
    min-height: 100px;
    position: relative;
    cursor: pointer;
    border: 1px solid #edf2f7;
    transition: box-shadow 0.2s, transform 0.1s;
  }

  .day:hover {
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transform: translateY(-2px);
  }

  .day.today {
    border: 2px solid var(--primary);
  }

  .date-num {
    font-weight: 600;
    font-size: 0.95rem;
    margin-bottom: 2px;
  }

  .event-name {
    display: block;
    font-size: 0.85rem;
    color: var(--primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Hover/Tap overlay */
  .tooltip {
    display: none;
    position: absolute;
    inset: 0;
    background: rgba(43,108,176,0.95);
    color: #fff;
    border-radius: 10px;
    padding: 10px;
    font-size: 0.85rem;
    text-align: left;
    line-height: 1.3;
    z-index: 5;
  }

  .day:hover .tooltip,
  .day.show-tooltip .tooltip {
    display: block;
  }

  /* Mobile view */
  @media (max-width: 900px) {
    #calendar {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  @media (max-width: 600px) {
    #calendar {
      display: block;
    }
    .day {
      margin-bottom: 10px;
      padding: 12px;
      min-height: auto;
    }
    .tooltip {
      position: static;
      display: block;
      background: none;
      color: var(--text);
      padding: 0;
    }
    .event-name {
      color: var(--muted);
    }
  }
</style>
</head>
<body>

<header>Church Events Calendar</header>

<div id="calendar-container">
  <div id="calendar-nav">
    <button id="prev-month">&lt; Prev</button>
    <span id="month-year"></span>
    <button id="next-month">Next &gt;</button>
  </div>
  <div id="status" style="text-align:center;margin-bottom:10px;color:var(--muted);"></div>
  <div id="calendar"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8HNWc5Lj5FPBV3vJfpUa3S4_W2h4O32e6W6uxqhamh4riojoSqtCnBpTrPabaln0esefo3ixCbp-v/pub?output=csv";
let events = [];
let currentDate = new Date();
const monthMap = {
  "January":1,"February":2,"March":3,"April":4,"May":5,"June":6,
  "July":7,"August":8,"September":9,"October":10,"November":11,"December":12
};

async function loadData() {
  const status = document.getElementById("status");
  status.textContent = "Loading data...";
  try {
    const res = await fetch(CSV_URL);
    const text = await res.text();
    Papa.parse(text, {
      skipEmptyLines: true,
      complete: function(results){
        const data = results.data;
        let headerRowIndex = data.findIndex(r => r.some(cell => (cell||'').toUpperCase().includes("DATE")));
        if(headerRowIndex < 0){
          status.textContent = "Error: Header not found!";
          status.style.color = "red";
          return;
        }
        const headers = data[headerRowIndex].map(h => (h||'').trim().toUpperCase());
        const rows = data.slice(headerRowIndex+1);
        events = rows.map(row => {
          const obj = {};
          headers.forEach((h,i) => obj[h] = (row[i]||'').trim());
          if(obj['DATE']){
            const parts = obj['DATE'].split(',');
            const datePart = parts.slice(1).join(',').trim();
            if(datePart){
              const [monthName, dayStr, yearStr] = datePart.replace(/,/g,'').split(' ');
              const month = monthMap[monthName];
              const day = parseInt(dayStr);
              const year = parseInt(yearStr);
              if(month && day && year){
                obj.parsedDate = `${year}-${String(month).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
              }
            }
          }
          return obj;
        }).filter(e => e.parsedDate);
        status.textContent = `Loaded ${events.length} events.`;
        buildCalendar();
      }
    });
  } catch(e){
    console.error(e);
    status.textContent = "Error loading data.";
    status.style.color = "red";
  }
}

function buildCalendar(){
  const calendar = document.getElementById("calendar");
  calendar.innerHTML = "";
  const month = currentDate.getMonth();
  const year = currentDate.getFullYear();

  document.getElementById("month-year").textContent = currentDate.toLocaleString('default',{month:'long',year:'numeric'});

  const dayNames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
  dayNames.forEach(d => {
    const dn = document.createElement("div");
    dn.className = "day-name";
    dn.textContent = d;
    calendar.appendChild(dn);
  });

  const firstDay = new Date(year, month, 1).getDay();
  const totalDays = new Date(year, month+1, 0).getDate();
  const today = new Date();

  for(let i=0;i<firstDay;i++){
    const empty = document.createElement("div");
    empty.className = "day";
    calendar.appendChild(empty);
  }

  for(let d=1; d<=totalDays; d++){
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const dayDiv = document.createElement("div");
    dayDiv.className = "day";
    if(today.getDate()===d && today.getMonth()===month && today.getFullYear()===year)
      dayDiv.classList.add("today");

    const num = document.createElement("div");
    num.className = "date-num";
    num.textContent = d;
    dayDiv.appendChild(num);

    const dayEvents = events.filter(e => e.parsedDate === dateStr);
    dayEvents.forEach(e => {
      if(e.PROGRAM){
        const name = document.createElement("span");
        name.className = "event-name";
        name.textContent = e.PROGRAM;
        dayDiv.appendChild(name);

        const tooltip = document.createElement("div");
        tooltip.className = "tooltip";
        tooltip.innerHTML = `
          <strong>${e.PROGRAM}</strong><br>
          ${e.LOCATION ? `üìç ${e.LOCATION}<br>` : ""}
          ${e.CONTACT ? `‚òéÔ∏è ${e.CONTACT}<br>` : ""}
          ${e.COMMENTS ? `üí¨ ${e.COMMENTS}` : ""}
        `;
        dayDiv.appendChild(tooltip);

        dayDiv.addEventListener("click", (ev) => {
          ev.stopPropagation();
          document.querySelectorAll(".day.show-tooltip").forEach(d => d.classList.remove("show-tooltip"));
          dayDiv.classList.toggle("show-tooltip");
        });
      }
    });

    calendar.appendChild(dayDiv);
  }

  document.body.addEventListener("click", () => {
    document.querySelectorAll(".day.show-tooltip").forEach(d => d.classList.remove("show-tooltip"));
  });
}

document.getElementById("prev-month").addEventListener("click",()=>{currentDate.setMonth(currentDate.getMonth()-1); buildCalendar();});
document.getElementById("next-month").addEventListener("click",()=>{currentDate.setMonth(currentDate.getMonth()+1); buildCalendar();});
loadData();
</script>
</body>
</html>
