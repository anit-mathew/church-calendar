<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ICANJ Church Calendar</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
  body{font-family:Arial,sans-serif;background:#efefef;margin:0;padding:0;display:flex;justify-content:center;}
  .wrap{max-width:720px;width:100%;background:#fff;margin:20px;border-radius:8px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.1);}
  .title-strip{background:#1f6399;color:white;text-align:center;font-weight:600;padding:12px;font-size:1.25rem;}
  .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;padding:10px;}
  .day{padding:8px;text-align:center;cursor:pointer;border-radius:6px;position:relative;}
  .day.disabled{opacity:0.3;cursor:default;}
  .day.selected{background:rgba(40,121,184,0.2);}
  .dot{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:auto;background:rgba(40,121,184,0.1);}
  .event-dot{width:6px;height:6px;border-radius:50%;background:#ffd54f;position:absolute;bottom:6px;left:50%;transform:translateX(-50%);}
  .events-panel{padding:12px;border-top:1px solid #ddd;background:#fafafa;}
  .event-item{margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid #eee;}
  .event-title{font-weight:600;}
  .no-events{text-align:center;font-style:italic;color:#888;}
</style>
</head>
<body>
<div class="wrap">
  <div class="title-strip">ICANJ Church Calendar</div>
  <div class="calendar-grid" id="calendarGrid"></div>
  <div class="events-panel" id="eventsPanel">
    <div id="panelDate">Select a date</div>
    <div id="panelList"><div class="no-events">No events selected.</div></div>
  </div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8HNWc5Lj5FPBV3vJfpUa3S4_W2h4O32e6W6uxqhamh4riojoSqtCnBpTrPabaln0esefo3ixCbp-v/pub?output=csv";

let events=[];

function parseDate(str){
  if(!str) return null;
  // Match Thursday, January 1, 2026 or January 1, 2026
  const m = str.match(/([A-Za-z]+,?\s*)?([A-Za-z]+) (\d{1,2}),? (\d{4})/);
  if(m){
    const monthNames={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11};
    const mon=monthNames[m[2].toLowerCase()];
    const day=parseInt(m[3]);
    const year=parseInt(m[4]);
    if(mon!==undefined) return new Date(year, mon, day);
  }
  const d=new Date(str);
  return isNaN(d)?null:d;
}

function ymd(d){return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;}

function loadCSV(){
  Papa.parse(CSV_URL,{
    download:true,
    header:true,
    skipEmptyLines:true,
    complete: function(results){
      events=[];
      results.data.forEach(r=>{
        const date=parseDate(r['DATE']||r['Date']);
        if(!date) return;
        const vis=(r['VISIBILITY']||r['Visibility']||'public').toLowerCase();
        if(vis!=='public') return;
        events.push({
          date:ymd(date),
          program:r['PROGRAM']||r['Program']||'Untitled Event',
          location:r['LOCATION']||r['Location']||'',
          contact:r['CONTACT']||r['Contact']||'',
          comments:r['COMMENTS']||r['Comments']||''
        });
      });
      renderCalendar();
    }
  });
}

function renderCalendar(){
  const grid=document.getElementById('calendarGrid');
  grid.innerHTML='';
  const today=new Date();
  const year=today.getFullYear();
  const month=today.getMonth();
  const first=new Date(year,month,1);
  const startDay=(first.getDay()+6)%7;
  const daysInMonth=new Date(year,month+1,0).getDate();

  for(let i=0;i<startDay;i++){ const e=document.createElement('div'); e.className='day disabled'; grid.appendChild(e); }
  for(let d=1;d<=daysInMonth;d++){
    const dateObj=new Date(year,month,d);
    const ymdStr=ymd(dateObj);
    const dayDiv=document.createElement('div'); dayDiv.className='day';
    const dot=document.createElement('div'); dot.className='dot'; dot.textContent=d; dayDiv.appendChild(dot);

    if(events.find(e=>e.date===ymdStr)){ const evDot=document.createElement('div'); evDot.className='event-dot'; dayDiv.appendChild(evDot); }

    dayDiv.addEventListener('click',()=>{
      const list=document.getElementById('panelList');
      const panelDate=document.getElementById('panelDate');
      panelDate.textContent=dateObj.toDateString();
      const dayEvents=events.filter(e=>e.date===ymdStr);
      if(dayEvents.length===0){ list.innerHTML='<div class="no-events">No events for this day.</div>'; return; }
      list.innerHTML='';
      dayEvents.forEach(ev=>{
        const div=document.createElement('div'); div.className='event-item';
        div.innerHTML=`<div class="event-title">${ev.program}</div>
          ${ev.location?`üìç ${ev.location} `:''}${ev.contact?` ‚Ä¢ ‚òé ${ev.contact}`:''}
          ${ev.comments?`<div style="color:#888;font-size:0.85rem">${ev.comments}</div>`:''}`;
        list.appendChild(div);
      });
    });

    grid.appendChild(dayDiv);
  }
}

loadCSV();
</script>
</body>
</html>
