<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Church Calendar</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f8f6f3;
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 {
    color: #5a3e36;
  }
  .calendar {
    display: inline-block;
    width: 90%;
    max-width: 800px;
    border-collapse: collapse;
    background: #fff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  th {
    background: #e4cfc1;
    color: #3a2f2f;
    padding: 10px;
  }
  td {
    width: 14.2%;
    height: 100px;
    border: 1px solid #e0d8d3;
    vertical-align: top;
    padding: 5px;
    position: relative;
  }
  .day-number {
    font-weight: bold;
  }
  .event {
    background: #f3e3d3;
    border-radius: 8px;
    padding: 3px;
    margin-top: 5px;
    font-size: 12px;
    cursor: pointer;
  }
  .tooltip {
    display: none;
    position: absolute;
    background: #fff9f4;
    border: 1px solid #e0d8d3;
    border-radius: 8px;
    padding: 8px;
    font-size: 12px;
    top: 100%;
    left: 0;
    z-index: 10;
    width: 180px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .event:hover .tooltip {
    display: block;
  }
  .nav-buttons {
    margin: 10px;
  }
  button {
    background: #8b6f47;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover {
    background: #6d5534;
  }
</style>
</head>
<body>
<h1>Church Event Calendar</h1>
<div class="nav-buttons">
  <button onclick="changeMonth(-1)">&#8592; Previous</button>
  <span id="monthYear"></span>
  <button onclick="changeMonth(1)">Next &#8594;</button>
</div>
<table class="calendar" id="calendar"></table>

<script>
let events = [];
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

async function loadCSV() {
  const response = await fetch('events.csv'); // your published CSV URL
  const text = await response.text();
  const rows = text.trim().split('\n').map(r => r.split(','));
  const headers = rows[0].map(h => h.trim());
  
  events = rows.slice(1)
    .map(row => {
      const obj = {};
      headers.forEach((h, i) => obj[h] = row[i] ? row[i].trim() : '');
      return obj;
    })
    // âœ… Show only events marked as Public
    .filter(e => e['Visibility'] && e['Visibility'].toLowerCase() === 'public');
  
  renderCalendar(currentMonth, currentYear);
}

function renderCalendar(month, year) {
  const calendar = document.getElementById('calendar');
  const monthYear = document.getElementById('monthYear');
  const monthNames = [
    'January','February','March','April','May','June',
    'July','August','September','October','November','December'
  ];

  monthYear.textContent = `${monthNames[month]} ${year}`;
  
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  let html = '<tr>' + ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d => `<th>${d}</th>`).join('') + '</tr><tr>';
  
  for (let i = 0; i < firstDay; i++) html += '<td></td>';

  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${monthNames[month]} ${day}, ${year}`;
    const dayEvents = events.filter(e => e['DATE'].includes(dateStr));
    
    html += `<td><div class="day-number">${day}</div>`;
    dayEvents.forEach(ev => {
      html += `<div class="event">${ev['PROGRAM']}
        <div class="tooltip">
          <b>Location:</b> ${ev['LOCATION'] || 'N/A'}<br>
          <b>Contact:</b> ${ev['CONTACT'] || 'N/A'}<br>
          <b>Comments:</b> ${ev['COMMENTS'] || ''}
        </div></div>`;
    });
    html += '</td>';

    if ((day + firstDay) % 7 === 0 && day < daysInMonth) html += '</tr><tr>';
  }

  html += '</tr>';
  calendar.innerHTML = html;
}

function changeMonth(offset) {
  currentMonth += offset;
  if (currentMonth < 0) { currentMonth = 11; currentYear--; }
  if (currentMonth > 11) { currentMonth = 0; currentYear++; }
  renderCalendar(currentMonth, currentYear);
}

loadCSV();
</script>
</body>
</html>
